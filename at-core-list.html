<!--
Copyright (c) 2014 adenin TECHNOLOGIES. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
-->
<!--
`at-core-list` displays a responsive list. The template inside the
`at-core-list` element represents the dom to create for each list item. The
`data` property specifies an array of list item data. The `height` property
represents the height of a list item.


    <at-core-list data="{{data}}" height="80">
      <template>
        <div>List row: {{index}}</div>
      </template>
    </at-core-list>

-->
<link rel="import" href="../polymer/polymer.html">

<polymer-element name="at-core-list" attributes="data">
  <template>
    <style>
      :host {
        width: 100%;
        display: block;
      }

      #listWrapper {
        width: 100%;
      }

      .listContainer {
      }

      .listItem {
        background: #FFF;
        padding: 0px;
        margin: 10px;
        overflow: visible;
        float: left;
        height: 80px;
        border-radius: 2px;
        box-shadow: 0 2px 10px 0 rgba(0, 0, 0, 0.16);
      }

      .listItem > :first-child {
        box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.26);
        box-sizing: border-box;
        height: 100%;
      }

      .cols-1 .listItem {
        width: 100% !important;
        padding-top: 8px;
        padding-bottom: 8px;
        margin: 0px;
        border-width: 0px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.16);
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        height: auto !important;
        box-shadow: none;
      }

      .cols-1 .listItem > :first-child {
        box-shadow: none;
      }

      .cols-2 .listItem {
        width: calc(50% - 10px - 10px - 1px - 1px) !important;
      }

      .cols-3 .listItem {
        width: calc(33% - 10px - 10px - 1px - 1px) !important;
      }

      .cols-4 .listItem {
        width: calc(25% - 10px - 10px - 1px - 1px) !important;
      }

      .cols-5 .listItem {
        width: calc(20% - 10px - 10px - 1px - 1px) !important;
      }
    </style>
    <shadow></shadow>
  </template>
  <script>
    Polymer('at-core-list', {
      publish: {
        cardWidth: 320
      },

      attached: function () {
        this.template = this.querySelector('template');
      },

      observe: {
        'data template': 'initialize'
      },

      layout: function () {

        // get the container width
        var wrapper = this.shadowRoot.getElementById("listWrapper");
        var cw = wrapper.offsetWidth;

        // number of columns 1...5
        var cols = Math.floor(cw / this.cardWidth);
        if (cols < 1) cols = 1;
        if (cols > 5) cols = 5;

        wrapper.className = "cols-" + cols;

      },

      initialize: function () {
        if (!this.data || !this.template) {
          return;
        }

        // listWrapper is used to get the available width
        var listWrapper = document.createElement("div");
        listWrapper.id = "listWrapper";
        this.shadowRoot.appendChild(listWrapper);

        // calculate layout columns
        this.layout();

        // create list container
        var listContainer = document.createElement("div");
        listContainer.classList.add("listContainer");


        var listItem = document.createElement("div");
        listItem.className = "listItem";


        // apply template for each data item
        //  ... wrap result with card layout div
        //  ... and add to listContainer
        for (i = 0; i < this.data.length; i++) {
          var item = this.template.createInstance(this.data[i]);

          var div = listItem.cloneNode(true);
          div.appendChild(item);


          listContainer.appendChild(div);

        };

        //append list container to shadow dom
        //this.shadowRoot.appendChild(listContainer);
        listWrapper.appendChild(listContainer);

      },
      domReady: function () {

        // update layout after windows resize
        window.addEventListener('resize', function () {
          this.layout();
        }.bind(this), true);

        // update layout after orientation change
        window.addEventListener('orientationchange', function () {          
          setTimeout(function () {
            this.layout();            
          }.bind(this), 100);
        }.bind(this), false);

        // show/hide drawer changes also the available width
        window.addEventListener('core-responsive-change', function () {
          setTimeout(function () {
            this.layout();
          }.bind(this), 100);
        }.bind(this), false);

      },
      ready: function () {

      }
    });

  </script>
</polymer-element>
